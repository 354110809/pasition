/**
 * pasition v0.4.0 By dntzhang
 * Github: https://github.com/AlloyTeam/pasition
 * MIT Licensed.
 */

!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):r.pasition=t()}(this,function(){"use strict";function r(r){var n=[];return r.replace(m,function(r,a,e){var u=a.toLowerCase();for(e=t(e),"m"==u&&e.length>2&&(n.push([a].concat(e.splice(0,2))),u="l",a="m"==a?"l":"L");;){if(e.length==b[u])return e.unshift(a),n.push(e);if(e.length<b[u])throw new Error("malformed path data");n.push([a].concat(e.splice(0,b[u])))}}),n}function t(r){var t=r.match(d);return t?t.map(Number):[]}function n(r){var t=r[0],n=r[2],a=r[4],e=r[6],u=r[1],s=r[3],o=r[5],c=r[7];return[Math.min(t,n,a,e),Math.min(u,s,o,c),Math.max(t,n,a,e),Math.max(u,s,o,c)]}function a(r){var t=r[0][0],n=r[0][1],a=t,e=n;return r.forEach(function(r){var u=r[0],s=r[2],o=r[4],c=r[6],i=r[1],h=r[3],p=r[5],f=r[7];t=Math.min(t,u,s,o,c),n=Math.min(n,i,h,p,f),a=Math.max(a,u,s,o,c),e=Math.max(e,i,h,p,f)}),[t,n,a,e]}function e(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2))+Math.sqrt(Math.pow(r[2]-t[2],2)+Math.pow(r[3]-t[3],2))}function u(r,t){var a=o(r.length),u=[];a.forEach(function(a){var s=0;a.forEach(function(a){s+=e(n(r[a]),n(t[a]))}),u.push({index:a,distance:s})}),u.sort(function(r,t){return r.distance-t.distance});var s=[];return u[0].index.forEach(function(t){s.push(r[t])}),s}function s(r,t){var n=c(r.length),u=[];n.forEach(function(n){var s=0;n.forEach(function(n){s+=e(a(r[n]),a(t[n]))}),u.push({index:n,distance:s})}),u.sort(function(r,t){return r.distance-t.distance});var s=[];return u[0].index.forEach(function(t){s.push(r[t])}),s}function o(r){for(var t=[],n=0;n<r;n++){for(var a=[],e=0;e<r;e++){var u=e+n;u>r-1&&(u-=r),a[u]=e}t.push(a)}return t}function c(r){for(var t=[],n=0;n<r;n++)t.push(n);return i(t)}function i(r){function t(r){var e,u;for(e=0;e<r.length;e++)u=r.splice(e,1)[0],a.push(u),0==r.length&&n.push(a.slice()),t(r),r.splice(e,0,u),a.pop();return n}var n=[],a=[];return t(r)}function h(r,t,n,a,e,u,s,o,c){return{left:p(r,t,n,a,e,u,s,o,c),right:p(s,o,e,u,n,a,r,t,1-c,!0)}}function p(r,t,n,a,e,u,s,o,c,i){var h=(n-r)*c+r,p=(a-t)*c+t,f=(e-n)*c+n,l=(u-a)*c+a,v=(s-e)*c+e,x=(o-u)*c+u,y=(f-h)*c+h,g=(l-p)*c+p,M=(v-f)*c+f,b=(x-l)*c+l,m=(M-y)*c+y,d=(b-g)*c+g;return i?[m,d,y,g,h,p,r,t]:[r,t,h,p,y,g,m,d]}var f=function(){function r(r,t){var n=[],a=!0,e=!1,u=void 0;try{for(var s,o=r[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(r){e=!0,u=r}finally{try{!a&&o.return&&o.return()}finally{if(e)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=2*Math.PI,v=function(r,t,n,a,e,u,s){var o=r.x,c=r.y;return o*=t,c*=n,{x:a*o-e*c+u,y:e*o+a*c+s}},x=function(r,t){var n=4/3*Math.tan(t/4),a=Math.cos(r),e=Math.sin(r),u=Math.cos(r+t),s=Math.sin(r+t);return[{x:a-e*n,y:e+a*n},{x:u+s*n,y:s-u*n},{x:u,y:s}]},y=function(r,t,n,a){var e=r*a-t*n<0?-1:1,u=Math.sqrt(r*r+t*t),s=Math.sqrt(r*r+t*t),o=r*n+t*a,c=o/(u*s);return c>1&&(c=1),c<-1&&(c=-1),e*Math.acos(c)},g=function(r,t,n,a,e,u,s,o,c,i,h,p){var f=Math.pow(e,2),v=Math.pow(u,2),x=Math.pow(h,2),g=Math.pow(p,2),M=f*v-f*g-v*x;M<0&&(M=0),M/=f*g+v*x,M=Math.sqrt(M)*(s===o?-1:1);var b=M*e/u*p,m=M*-u/e*h,d=i*b-c*m+(r+n)/2,w=c*b+i*m+(t+a)/2,q=(h-b)/e,k=(p-m)/u,E=(-h-b)/e,S=(-p-m)/u,_=y(1,0,q,k),A=y(q,k,E,S);return 0===o&&A>0&&(A-=l),1===o&&A<0&&(A+=l),[d,w,_,A]},M=function(r){var t=r.px,n=r.py,a=r.cx,e=r.cy,u=r.rx,s=r.ry,o=r.xAxisRotation,c=void 0===o?0:o,i=r.largeArcFlag,h=void 0===i?0:i,p=r.sweepFlag,y=void 0===p?0:p,M=[];if(0===u||0===s)return[];var b=Math.sin(c*l/360),m=Math.cos(c*l/360),d=m*(t-a)/2+b*(n-e)/2,w=-b*(t-a)/2+m*(n-e)/2;if(0===d&&0===w)return[];u=Math.abs(u),s=Math.abs(s);var q=Math.pow(d,2)/Math.pow(u,2)+Math.pow(w,2)/Math.pow(s,2);q>1&&(u*=Math.sqrt(q),s*=Math.sqrt(q));var k=g(t,n,a,e,u,s,h,y,b,m,d,w),E=f(k,4),S=E[0],_=E[1],A=E[2],C=E[3],F=Math.max(Math.ceil(Math.abs(C)/(l/4)),1);C/=F;for(var N=0;N<F;N++)M.push(x(A,C)),A+=C;return M.map(function(r){var t=v(r[0],u,s,m,b,S,_),n=t.x,a=t.y,e=v(r[1],u,s,m,b,S,_),o=e.x,c=e.y,i=v(r[2],u,s,m,b,S,_);return{x1:n,y1:a,x2:o,y2:c,x:i.x,y:i.y}})},b={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},m=/([astvzqmhlc])([^astvzqmhlc]*)/gi,d=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,w={};return w.parser=r,w.lerpCurve=function(r,t,n){return n<0?n=0:n>1&&(n=1),w.lerpPoints(r[0],r[1],t[0],t[1],n).concat(w.lerpPoints(r[2],r[3],t[2],t[3],n)).concat(w.lerpPoints(r[4],r[5],t[4],t[5],n)).concat(w.lerpPoints(r[6],r[7],t[6],t[7],n))},w.lerpPoints=function(r,t,n,a,e){return[r+(n-r)*e,t+(a-t)*e]},w.q2b=function(r,t,n,a,e,u){return[r,t,(r+2*n)/3,(t+2*a)/3,(e+2*n)/3,(u+2*a)/3,e,u]},w.path2shapes=function(r){for(var t,n,a,e,u=w.parser(r),s=0,o=0,c=0,i=u.length,h=[],p=null;c<i;c++){var f=u[c],l=f[0],v=u[c-1];switch(l){case"m":var x=h.length;h[x]=[],p=h[x],s+=f[1],o+=f[2];break;case"M":var x=h.length;h[x]=[],p=h[x],s=f[1],o=f[2];break;case"l":p.push([s,o,s,o,s,o,s+f[1],o+f[2]]),s+=f[1],o+=f[2];break;case"L":p.push([s,o,f[1],f[2],f[1],f[2],f[1],f[2]]),s=f[1],o=f[2];break;case"h":p.push([s,o,s,o,s,o,s+f[1],o]),s+=f[1];break;case"H":p.push([s,o,f[1],o,f[1],o,f[1],o]),s=f[1];break;case"v":p.push([s,o,s,o,s,o,s,o+f[1]]),o+=f[1];break;case"V":p.push([s,o,s,f[1],s,f[1],s,f[1]]),o=f[1];break;case"C":p.push([s,o,f[1],f[2],f[3],f[4],f[5],f[6]]),s=f[5],o=f[6];break;case"S":"C"===v[0]||"c"===v[0]?p.push([s,o,s+v[5]-v[3],o+v[6]-v[4],f[1],f[2],f[3],f[4]]):"S"!==v[0]&&"s"!==v[0]||p.push([s,o,s+v[3]-v[1],o+v[4]-v[2],f[1],f[2],f[3],f[4]]),s=f[3],o=f[4];break;case"c":p.push([s,o,s+f[1],o+f[2],s+f[3],o+f[4],s+f[5],o+f[6]]),s+=f[5],o+=f[6];break;case"s":"C"===v[0]||"c"===v[0]?p.push([s,o,s+v[5]-v[3],o+v[6]-v[4],s+f[1],o+f[2],s+f[3],o+f[4]]):"S"!==v[0]&&"s"!==v[0]||p.push([s,o,s+v[3]-v[1],o+v[4]-v[2],s+f[1],o+f[2],s+f[3],o+f[4]]),s+=f[3],o+=f[4];break;case"a":var y={rx:f[1],ry:f[2],px:s,py:o,xAxisRotation:f[3],largeArcFlag:f[4],sweepFlag:f[5],cx:s+f[6],cy:s+f[7]},g=M(y),b=g[g.length-1];g.forEach(function(r,t){0===t?p.push([s,o,r.x1,r.y1,r.x2,r.y2,r.x,r.y]):p.push([g[t-1].x,g[t-1].y,r.x1,r.y1,r.x2,r.y2,r.x,r.y])}),s=b.x,o=b.y;break;case"A":var y={rx:f[1],ry:f[2],px:s,py:o,xAxisRotation:f[3],largeArcFlag:f[4],sweepFlag:f[5],cx:f[6],cy:f[7]},g=M(y),b=g[g.length-1];g.forEach(function(r,t){0===t?p.push([s,o,r.x1,r.y1,r.x2,r.y2,r.x,r.y]):p.push([g[t-1].x,g[t-1].y,r.x1,r.y1,r.x2,r.y2,r.x,r.y])}),s=b.x,o=b.y;break;case"Q":p.push(w.q2b(s,o,f[1],f[2],f[3],f[4])),s=f[3],o=f[4];break;case"q":p.push(w.q2b(s,o,s+f[1],o+f[2],f[3]+s,f[4]+o)),s+=f[3],o+=f[4];break;case"T":"Q"===v[0]||"q"===v[0]?(a=s+v[3]-v[1],e=o+v[4]-v[2],p.push(w.q2b(s,o,a,e,f[1],f[2]))):"T"!==v[0]&&"t"!==v[0]||(p.push(w.q2b(s,o,s+s-a,o+o-e,f[1],f[2])),a=s+s-a,e=o+o-e),s=f[1],o=f[2];break;case"t":"Q"===v[0]||"q"===v[0]?(a=s+v[3]-v[1],e=o+v[4]-v[2],p.push(w.q2b(s,o,a,e,s+f[1],o+f[2]))):"T"!==v[0]&&"t"!==v[0]||(p.push(w.q2b(s,o,s+s-a,o+o-e,s+f[1],o+f[2])),a=s+s-a,e=o+o-e),s+=f[1],o+=f[2];break;case"Z":case"z":t=p[0][0],n=p[0][1],p.push([s,o,t,n,t,n,t,n])}}return h},w._upCurves=function(r,t){for(var n=0,a=0,e=r.length;n<t;n++)r.push(r[a].slice(0)),++a>e-1&&(a-=e)},w._splitCurves=function(r,t){var n=0,a=0;for(console.log(JSON.stringify(r));n<t;n++){var e=r[a],u=h(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],.5);r.splice(a,1),r.splice(a,0,u.left,u.right),a+=2,a>=r.length-1&&(a=0)}},w._upShapes=function(r,t){for(var n=0;n<t;n++){var a=r[r.length-1],e=[];a.forEach(function(r){e.push(r.slice(0))}),r.push(e)}},w.lerp=function(r,t,n){return w._lerp(w.path2shapes(r),w.path2shapes(t),n)},w._preprocessing=function(r,t){var n=r.length,a=t.length,r=JSON.parse(JSON.stringify(r)),t=JSON.parse(JSON.stringify(t));return n>a?w._upShapes(t,n-a):n<a&&w._upShapes(r,a-n),r=s(r,t),r.forEach(function(r,n){var a=r.length,e=t[n].length;a>e?w._splitCurves(t[n],a-e):a<e&&w._upCurves(r,e-a)}),r.forEach(function(n,a){r[a]=u(n,t[a])}),[r,t]},w._lerp=function(r,t,n){var a=[];return r.forEach(function(r,e){var u=[];r.forEach(function(r,a){u.push(w.lerpCurve(r,t[e][a],n))}),a.push(u)}),a},w.animate=function(r,t,n,a){r=w.path2shapes(r),t=w.path2shapes(t);var e=w._preprocessing(r,t),u=new Date,s=a.end||function(){},o=a.progress||function(){},c=a.begin||function(){},i=a.easing||function(r){return r},h=null,p=null;c(r);!function r(){var a=new Date-u;if(a>=n)return p=t,o(p),s(p),void cancelAnimationFrame(h);p=w._lerp(e[0],e[1],i(a/n)),o(p),h=requestAnimationFrame(r)}()},w});
