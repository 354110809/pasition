/**
 * pasition v0.5.0 By dntzhang
 * Github: https://github.com/AlloyTeam/pasition
 * MIT Licensed.
 */

!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.pasition=r()}(this,function(){"use strict";function t(t){var n=[];return t.replace(d,function(t,a,e){var o=a.toLowerCase();for(e=r(e),"m"==o&&e.length>2&&(n.push([a].concat(e.splice(0,2))),o="l",a="m"==a?"l":"L");;){if(e.length==b[o])return e.unshift(a),n.push(e);if(e.length<b[o])throw new Error("malformed path data");n.push([a].concat(e.splice(0,b[o])))}}),n}function r(t){var r=t.match(w);return r?r.map(Number):[]}function n(t){var r=t[0][0],n=t[0][1],a=r,e=n;return t.forEach(function(t){var o=t[0],u=t[2],s=t[4],h=t[6],i=t[1],c=t[3],p=t[5],f=t[7];r=Math.min(r,o,u,s,h),n=Math.min(n,i,c,p,f),a=Math.max(a,o,u,s,h),e=Math.max(e,i,c,p,f)}),[r,n,a,e]}function a(t,r){return Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))+Math.sqrt(Math.pow(t[2]-r[2],2)+Math.pow(t[3]-r[3],2))}function e(t,r){var n=t[0],a=t[2],e=t[4],o=t[6],u=t[1],s=t[3],h=t[5],i=t[7],c=r[0],p=r[2],f=r[4],l=r[6],v=r[1],x=r[3],y=r[5],M=r[7];return Math.sqrt(Math.pow(c-n,2)+Math.pow(v-u,2))+Math.sqrt(Math.pow(p-a,2)+Math.pow(x-s,2))+Math.sqrt(Math.pow(f-e,2)+Math.pow(y-h,2))+Math.sqrt(Math.pow(l-o,2)+Math.pow(M-i,2))}function o(t,r){var n=s(t.length),a=[];n.forEach(function(n){var o=0;n.forEach(function(n){o+=e(t[n],r[n])}),a.push({index:n,distance:o})}),a.sort(function(t,r){return t.distance-r.distance});var o=[];return a[0].index.forEach(function(r){o.push(t[r])}),o}function u(t,r){var e=h(t.length),o=[];e.forEach(function(e){var u=0;e.forEach(function(e){u+=a(n(t[e]),n(r[e]))}),o.push({index:e,distance:u})}),o.sort(function(t,r){return t.distance-r.distance});var u=[];return o[0].index.forEach(function(r){u.push(t[r])}),u}function s(t){for(var r=[],n=0;n<t;n++){for(var a=[],e=0;e<t;e++){var o=e+n;o>t-1&&(o-=t),a[o]=e}r.push(a)}return r}function h(t){for(var r=[],n=0;n<t;n++)r.push(n);return i(r)}function i(t){function r(t){var e,o;for(e=0;e<t.length;e++)o=t.splice(e,1)[0],a.push(o),0==t.length&&n.push(a.slice()),r(t),t.splice(e,0,o),a.pop();return n}var n=[],a=[];return r(t)}function c(t,r,n,a,e,o,u,s,h){return{left:p(t,r,n,a,e,o,u,s,h),right:p(u,s,e,o,n,a,t,r,1-h,!0)}}function p(t,r,n,a,e,o,u,s,h,i){var c=(n-t)*h+t,p=(a-r)*h+r,f=(e-n)*h+n,l=(o-a)*h+a,v=(u-e)*h+e,x=(s-o)*h+o,y=(f-c)*h+c,M=(l-p)*h+p,g=(v-f)*h+f,b=(x-l)*h+l,d=(g-y)*h+y,w=(b-M)*h+M;return i?[d,w,y,M,c,p,t,r]:[t,r,c,p,y,M,d,w]}var f=function(){function t(t,r){var n=[],a=!0,e=!1,o=void 0;try{for(var u,s=t[Symbol.iterator]();!(a=(u=s.next()).done)&&(n.push(u.value),!r||n.length!==r);a=!0);}catch(t){e=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(e)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return t(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=2*Math.PI,v=function(t,r,n,a,e,o,u){var s=t.x,h=t.y;return s*=r,h*=n,{x:a*s-e*h+o,y:e*s+a*h+u}},x=function(t,r){var n=4/3*Math.tan(r/4),a=Math.cos(t),e=Math.sin(t),o=Math.cos(t+r),u=Math.sin(t+r);return[{x:a-e*n,y:e+a*n},{x:o+u*n,y:u-o*n},{x:o,y:u}]},y=function(t,r,n,a){var e=t*a-r*n<0?-1:1,o=Math.sqrt(t*t+r*r),u=Math.sqrt(t*t+r*r),s=t*n+r*a,h=s/(o*u);return h>1&&(h=1),h<-1&&(h=-1),e*Math.acos(h)},M=function(t,r,n,a,e,o,u,s,h,i,c,p){var f=Math.pow(e,2),v=Math.pow(o,2),x=Math.pow(c,2),M=Math.pow(p,2),g=f*v-f*M-v*x;g<0&&(g=0),g/=f*M+v*x,g=Math.sqrt(g)*(u===s?-1:1);var b=g*e/o*p,d=g*-o/e*c,w=i*b-h*d+(t+n)/2,m=h*b+i*d+(r+a)/2,q=(c-b)/e,k=(p-d)/o,E=(-c-b)/e,A=(-p-d)/o,S=y(1,0,q,k),_=y(q,k,E,A);return 0===s&&_>0&&(_-=l),1===s&&_<0&&(_+=l),[w,m,S,_]},g=function(t){var r=t.px,n=t.py,a=t.cx,e=t.cy,o=t.rx,u=t.ry,s=t.xAxisRotation,h=void 0===s?0:s,i=t.largeArcFlag,c=void 0===i?0:i,p=t.sweepFlag,y=void 0===p?0:p,g=[];if(0===o||0===u)return[];var b=Math.sin(h*l/360),d=Math.cos(h*l/360),w=d*(r-a)/2+b*(n-e)/2,m=-b*(r-a)/2+d*(n-e)/2;if(0===w&&0===m)return[];o=Math.abs(o),u=Math.abs(u);var q=Math.pow(w,2)/Math.pow(o,2)+Math.pow(m,2)/Math.pow(u,2);q>1&&(o*=Math.sqrt(q),u*=Math.sqrt(q));var k=M(r,n,a,e,o,u,c,y,b,d,w,m),E=f(k,4),A=E[0],S=E[1],_=E[2],C=E[3],F=Math.max(Math.ceil(Math.abs(C)/(l/4)),1);C/=F;for(var P=0;P<F;P++)g.push(x(_,C)),_+=C;return g.map(function(t){var r=v(t[0],o,u,d,b,A,S),n=r.x,a=r.y,e=v(t[1],o,u,d,b,A,S),s=e.x,h=e.y,i=v(t[2],o,u,d,b,A,S);return{x1:n,y1:a,x2:s,y2:h,x:i.x,y:i.y}})},b={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},d=/([astvzqmhlc])([^astvzqmhlc]*)/gi,w=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,m={};return m.parser=t,m.lerpCurve=function(t,r,n){return m.lerpPoints(t[0],t[1],r[0],r[1],n).concat(m.lerpPoints(t[2],t[3],r[2],r[3],n)).concat(m.lerpPoints(t[4],t[5],r[4],r[5],n)).concat(m.lerpPoints(t[6],t[7],r[6],r[7],n))},m.lerpPoints=function(t,r,n,a,e){return[t+(n-t)*e,r+(a-r)*e]},m.q2b=function(t,r,n,a,e,o){return[t,r,(t+2*n)/3,(r+2*a)/3,(e+2*n)/3,(o+2*a)/3,e,o]},m.path2shapes=function(t){for(var r=m.parser(t),n=0,a=0,e=0,o=r.length,u=[],s=null,h=void 0,i=void 0,c=void 0,p=void 0,f=void 0,l=void 0,v=void 0;e<o;e++){var x=r[e],y=x[0],M=r[e-1];switch(y){case"m":f=u.length,u[f]=[],s=u[f],n+=x[1],a+=x[2];break;case"M":f=u.length,u[f]=[],s=u[f],n=x[1],a=x[2];break;case"l":s.push([n,a,n,a,n,a,n+x[1],a+x[2]]),n+=x[1],a+=x[2];break;case"L":s.push([n,a,x[1],x[2],x[1],x[2],x[1],x[2]]),n=x[1],a=x[2];break;case"h":s.push([n,a,n,a,n,a,n+x[1],a]),n+=x[1];break;case"H":s.push([n,a,x[1],a,x[1],a,x[1],a]),n=x[1];break;case"v":s.push([n,a,n,a,n,a,n,a+x[1]]),a+=x[1];break;case"V":s.push([n,a,n,x[1],n,x[1],n,x[1]]),a=x[1];break;case"C":s.push([n,a,x[1],x[2],x[3],x[4],x[5],x[6]]),n=x[5],a=x[6];break;case"S":"C"===M[0]||"c"===M[0]?s.push([n,a,n+M[5]-M[3],a+M[6]-M[4],x[1],x[2],x[3],x[4]]):"S"!==M[0]&&"s"!==M[0]||s.push([n,a,n+M[3]-M[1],a+M[4]-M[2],x[1],x[2],x[3],x[4]]),n=x[3],a=x[4];break;case"c":s.push([n,a,n+x[1],a+x[2],n+x[3],a+x[4],n+x[5],a+x[6]]),n+=x[5],a+=x[6];break;case"s":"C"===M[0]||"c"===M[0]?s.push([n,a,n+M[5]-M[3],a+M[6]-M[4],n+x[1],a+x[2],n+x[3],a+x[4]]):"S"!==M[0]&&"s"!==M[0]||s.push([n,a,n+M[3]-M[1],a+M[4]-M[2],n+x[1],a+x[2],n+x[3],a+x[4]]),n+=x[3],a+=x[4];break;case"a":l=g({rx:x[1],ry:x[2],px:n,py:a,xAxisRotation:x[3],largeArcFlag:x[4],sweepFlag:x[5],cx:n+x[6],cy:n+x[7]}),v=l[l.length-1],l.forEach(function(t,r){0===r?s.push([n,a,t.x1,t.y1,t.x2,t.y2,t.x,t.y]):s.push([l[r-1].x,l[r-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),n=v.x,a=v.y;break;case"A":l=g({rx:x[1],ry:x[2],px:n,py:a,xAxisRotation:x[3],largeArcFlag:x[4],sweepFlag:x[5],cx:x[6],cy:x[7]}),v=l[l.length-1],l.forEach(function(t,r){0===r?s.push([n,a,t.x1,t.y1,t.x2,t.y2,t.x,t.y]):s.push([l[r-1].x,l[r-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),n=v.x,a=v.y;break;case"Q":s.push(m.q2b(n,a,x[1],x[2],x[3],x[4])),n=x[3],a=x[4];break;case"q":s.push(m.q2b(n,a,n+x[1],a+x[2],x[3]+n,x[4]+a)),n+=x[3],a+=x[4];break;case"T":"Q"===M[0]||"q"===M[0]?(c=n+M[3]-M[1],p=a+M[4]-M[2],s.push(m.q2b(n,a,c,p,x[1],x[2]))):"T"!==M[0]&&"t"!==M[0]||(s.push(m.q2b(n,a,n+n-c,a+a-p,x[1],x[2])),c=n+n-c,p=a+a-p),n=x[1],a=x[2];break;case"t":"Q"===M[0]||"q"===M[0]?(c=n+M[3]-M[1],p=a+M[4]-M[2],s.push(m.q2b(n,a,c,p,n+x[1],a+x[2]))):"T"!==M[0]&&"t"!==M[0]||(s.push(m.q2b(n,a,n+n-c,a+a-p,n+x[1],a+x[2])),c=n+n-c,p=a+a-p),n+=x[1],a+=x[2];break;case"Z":case"z":h=s[0][0],i=s[0][1],s.push([n,a,h,i,h,i,h,i])}}return u},m._upCurves=function(t,r){for(var n=0,a=0,e=t.length;n<r;n++)t.push(t[a].slice(0)),++a>e-1&&(a-=e)},m._splitCurves=function(t,r){for(var n=0,a=0;n<r;n++){var e=t[a],o=c(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],.5);t.splice(a,1),t.splice(a,0,o.left,o.right),a+=2,a>=t.length-1&&(a=0)}},m._upShapes=function(t,r){for(var n=0;n<r;n++)!function(r){var n=t[t.length-1],a=[];n.forEach(function(t){a.push(t.slice(0))}),t.push(a)}()},m._subShapes=function(t,r,n){for(var a=0;a<n;a++)!function(t){var n=r[r.length-1],a=[],e=n[0][0],o=n[0][1];n.forEach(function(){a.push([e,o,e,o,e,o,e,o])}),r.push(a)}()},m.lerp=function(t,r,n){return m._lerp(m.path2shapes(t),m.path2shapes(r),n)},m._preprocessing=function(t,r){var n=t.length,a=r.length,e=JSON.parse(JSON.stringify(t)),s=JSON.parse(JSON.stringify(r));return n>a?m._subShapes(e,s,n-a):n<a&&m._upShapes(e,a-n),e=u(e,s),e.forEach(function(t,r){var n=t.length,a=s[r].length;n>a?m._splitCurves(s[r],n-a):n<a&&m._splitCurves(t,a-n)}),e.forEach(function(t,r){e[r]=o(t,s[r])}),[e,s]},m._lerp=function(t,r,n){var a=[];return t.forEach(function(t,e){var o=[];t.forEach(function(t,a){o.push(m.lerpCurve(t,r[e][a],n))}),a.push(o)}),a},m.animate=function(t){pathA=m.path2shapes(t.from),pathB=m.path2shapes(t.to);var r=m._preprocessing(pathA,pathB),n=new Date,a=t.end||function(){},e=t.progress||function(){},o=t.begin||function(){},u=t.easing||function(t){return t},s=null,h=null,i=t.time;o(pathA);!function t(){var o=new Date-n;if(o>=i)return h=pathB,e(h),a(h),void cancelAnimationFrame(s);h=m._lerp(r[0],r[1],u(o/i)),e(h),s=requestAnimationFrame(t)}()},m});
